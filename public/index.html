<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const messageInput = document.getElementById('messageInput');
  const sendButton = document.getElementById('sendButton');
  const messagesList = document.getElementById('messages');
  const themeToggle = document.getElementById('themeToggle');

  // Load saved theme
  const savedTheme = localStorage.getItem('chat-theme') || 'dark';
  if (savedTheme === 'light') {
    document.body.classList.add('light-mode');
    themeToggle.textContent = '☀️';
  }

  // Toggle theme
  themeToggle.addEventListener('click', () => {
    const isLight = document.body.classList.toggle('light-mode');
    localStorage.setItem('chat-theme', isLight ? 'light' : 'dark');
    themeToggle.textContent = isLight ? '☀️' : '🌙';
  });

  // Format time
  function getCurrentTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  // Add message to UI
  function addMessageToUI(message, type) {
    const li = document.createElement('li');
    li.className = `message ${type}`;
    const time = getCurrentTime();
    li.innerHTML = `<div class="message-text">${message}</div><small>${time}</small>`;
    messagesList.appendChild(li);
    messagesList.scrollTop = messagesList.scrollHeight;
  }

  // Send message
  function sendMessage() {
    const message = messageInput.value.trim();
    if (message) {
      // Show your message immediately (only once)
      addMessageToUI(message, 'sent');
      // Send to server
      socket.emit('chat message', message);
      messageInput.value = '';
    }
  }

  sendButton.addEventListener('click', sendMessage);
  messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });

  // Receive message from others (not from you)
  socket.on('chat message', (msg) => {
    addMessageToUI(msg, 'received');
  });

  // Focus input on load
  window.onload = () => messageInput.focus();
</script>
